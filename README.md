# ğŸ¤– POOKY
### í”„ë¡œì íŠ¸ ì§„í–‰ ê¸°ê°„
2024.10.1(í™”)~2024.12.26(ëª©)

## ğŸ¤—íŒ€ ë©¤ë²„
|ì´ë¦„|ì—­í• |ë‚´ìš©|
|:---:|:---:|:---|
|ë°°ì„¸í™©[íŒ€ì¥]|ì„¤ê³„| - Matlabì„ ì´ìš© ì •ê¸°êµ¬í•™ ë° ì—­ê¸°êµ¬í•™ êµ¬í˜„, ë¡œë´‡ì˜ ìš´ë™ ê²½ë¡œ ê³„ì‚° ë° ìµœì í™” <br> - Inventorì´ìš© ë‹¤ì¶• ë¡œë´‡ íŒ”ì˜ 3Dëª¨ë¸ë§, êµ¬ì¡°ì  ì•ˆì •ì„±ê³¼ ì‘ë™ ë²”ìœ„ ê²€ì¦ <br> - íŒ€ì› ê°„ì˜ ì›í™œí•œ í˜‘ì—…ì„ ìœ„í•œ í”„ë¡œì íŠ¸ ê´€ë¦¬|
|ê°•ì„œì—°[íŒ€ì›]|í†µì‹ , ì›¹|- HTMLê³¼ CSSë¥¼ ì´ìš©í•œ ì›¹ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„, ì‚¬ìš©ì ì¹œí™”ì ì¸ ì œì–´ í™˜ê²½ ì œê³µ <br> - Raspberry piì´ìš© í†µì‹  í”„ë¡œí† ì½œ ì„¤ê³„ ë° ë¡œë´‡ê³¼ì˜ ë°ì´í„° ì†¡ìˆ˜ì‹  êµ¬í˜„ <br> - ì‹œìŠ¤í…œì˜ ì‹¤ì‹œê°„ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ë° ì œì–´ë¥¼ ìœ„í•œ ë¡œë´‡ì˜ ì—­í•™ ë°ì´í„° ì›¹í˜ì´ì§€ ì ìš©|
|ê¹€ì°½ì„ [íŒ€ì›]|ì œì–´|- Raspberry piì´ìš© íšŒë¡œì„¤ê³„ ë° êµ¬ì„± <br> - ëª¨í„° ì„ ì • ë° ì œì–´ ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„, ë¡œë´‡ íŒ”ì˜ ë™ì‘ ë° ì •í™•ë„ í–¥ìƒ <br> - ë¡œë´‡ íŒ”ì˜ ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•œ ì•ˆì „ ì œì–´ ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„|
|ì´ì„¸ì˜[íŒ€ì›]|ì„¤ê³„, í†µì‹ |- Inventorì´ìš© 3Dëª¨ë¸ë§, ë¡œë´‡ íŒ” ë¶€í’ˆ ì„¤ê³„ ë° ì¡°ë¦½ ì‹œë®¬ë ˆì´ì…˜ <br> - Raspberry piì´ìš© í†µì‹  ëª¨ë“ˆ êµ¬í˜„, ë‹¤ì¶• ë¡œë´‡ íŒ”ì˜ ë„¤íŠ¸ì›Œí¬ ì—°ë™ <br> - í†µì‹  ì¥ì• ë¥¼ ìµœì†Œí™” í•˜ê¸° ìœ„í•œ ë°ì´í„° ì „ì†¡ í…ŒìŠ¤íŠ¸ ë° ë””ë²„ê¹…|

## ğŸ“Ÿí”„ë¡œì íŠ¸ ë°°ê²½
í˜„ëŒ€ ì‚°ì—…ì€ ìë™í™” ê¸°ìˆ ì˜ ë°œì „ê³¼ í•¨ê»˜ íš¨ìœ¨ì„±ê³¼ ìƒì‚°ì„±ì„ ê·¹ëŒ€í™”í•˜ê¸° ìœ„í•´ ë‹¤ì¶• ë¡œë´‡ì˜ í™œìš©ì´ ì ì  ì¤‘ìš”í•´ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ íë¦„ ì†ì—ì„œ ìš°ë¦¬ëŠ” ë‹¤ì¶• ë¡œë´‡ì— ëŒ€í•œ í•™ìŠµê³¼ ì´í•´ê°€ í•„ìˆ˜ì ì„ì„ ê¹¨ë‹«ê³ , ì´ë¥¼ ì§ì ‘ ì„¤ê³„í•˜ê³  êµ¬í˜„í•´ë³´ëŠ” ê²ƒì„ ëª©í‘œë¡œ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ë³¸ í”„ë¡œì íŠ¸ëŠ” ì„¤ê³„, ì œì–´, í”„ë¡œê·¸ë˜ë° ë“± ê°ê¸° ë‹¤ë¥¸ ì „ê³µê³¼ ì „ë¬¸ì„±ì„ ê°€ì§„ íŒ€ì›ë“¤ì´ í˜‘ë ¥í•˜ì—¬ ë‹¤ì¶• ë¡œë´‡ íŒ”ì„ ê°œë°œí•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í–ˆìŠµë‹ˆë‹¤. íŒ€ì›ë“¤ì€ ê°ìì˜ ì—­ëŸ‰ì„ ë°œíœ˜í•˜ì—¬ ë‹¤ì¶• ë¡œë´‡ íŒ”ì˜ ì„¤ê³„ì™€ ì œì‘ì„ ì§„í–‰í•˜ê³ , ì œì–´ ì•Œê³ ë¦¬ì¦˜ì„ í†µí•´ ë¡œë´‡ íŒ”ì„ ì •ë°€í•˜ê²Œ ì›€ì§ì¼ ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ë˜í•œ, ì›¹í˜ì´ì§€ì™€ì˜ ì—°ë™ì„ í†µí•´ ì‚¬ìš©ìê°€ ì›¹ í™˜ê²½ì—ì„œ ë¡œë´‡ íŒ”ì„ ì§ê´€ì ìœ¼ë¡œ ì œì–´í•  ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê³ ì í–ˆìŠµë‹ˆë‹¤.

ì´ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ìš°ë¦¬ëŠ” ë‹¤ì¶• ë¡œë´‡ì˜ êµ¬ì¡°ì™€ ì‘ë™ ì›ë¦¬ë¥¼ ê¹Šì´ ì´í•´í•˜ê³ , ì‹¤ì œ ì‚°ì—… í˜„ì¥ì—ì„œ ì ìš© ê°€ëŠ¥í•œ ìë™í™” ê¸°ìˆ ì„ ê²½í—˜í•˜ë©°, ê° ë¶„ì•¼ì˜ ì—­ëŸ‰ì„ ìœµí•©í•˜ì—¬ ì‹¤ì§ˆì ì¸ ê²°ê³¼ë¬¼ì„ ë§Œë“¤ì–´ë‚´ëŠ” ë° ì£¼ë ¥í–ˆìŠµë‹ˆë‹¤.

## âœ¨ê°œìš”
- 'POOKY(í‘¸í‚¤)'ëŠ” Rasberry pië¥¼ ê¸°ë°˜ìœ¼ë¡œ 6ê°œì˜ ëª¨í„° ì—°ê²°í•˜ì—¬ ì œì‘í•œ 6ì¶• ë¡œë´‡íŒ”ì…ë‹ˆë‹¤. flaskë¥¼ ì‚¬ìš©í•´ ì›¹í˜ì´ì§€ë¥¼ í†µí•´ ëª¨í„°ë¥¼ ì œì–´í•˜ê³  ê¸°êµ¬í•™ì„ í†µí•´ êµ¬í•œ X, Y, Z, Rx, Ry, Rzë¥¼ ì‚¬ìš©ìê°€ ì›¹ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Inventorë¥¼ ì´ìš©í•´ ë¡œë´‡íŒ” ë¶€í’ˆì„ ì œì‘í–ˆìŠµë‹ˆë‹¤. 3D ëª¨ë¸ë§ì„ í†µí•´ ê° ë¶€í’ˆì„ ì œì‘í•˜ê³  ì‹œë®¬ë ˆì´ì…˜ì„ í†µí•´ êµ¬ë™ë¶€ì— ë¬¸ì œì ì„ ì°¾ì•„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. ì´í›„ 3Dí”„ë¦°í„°ë¥¼ í†µí•´ ì œí’ˆì„ ë½‘ì•„ Raspberry piì™€ ëª¨í„°ì™€ í•¨ê»˜ ì¡°ë¦½í•˜ì—¬ 6ì¶•ë¡œë´‡ì„ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.

## ğŸ¯íƒ€ê²Ÿ
- ë¡œë´‡íŒ”ì— ê´€ì‹¬ì´ ìˆëŠ” ì…ë¬¸ì, ì´ˆë³´ì ì´ˆë³´ìë¥¼ ìœ„í•œ ê°€ì´ë“œ ì œì‘

## ê°œë°œí™˜ê²½
- ì„¤ê³„
<div>
 <img src="image-1.png" alt="Inventor" style="height: 30px; margin-bottom: 5px;">
</div>

- ì œì–´
<div>
 <img src="image-2.png" alt="Inventor" style="height: 30px; margin-bottom: 5px;">
</div>

- ì„ë² ë””ë“œ

![Raspberry Pi](https://img.shields.io/badge/-Raspberry_Pi-C51A4A?style=for-the-badge&logo=Raspberry-Pi)

- ê°œë°œì–¸ì–´

![Python](https://img.shields.io/badge/python-3670A0?style=for-the-badge&logo=python&logoColor=ffdd54)
![JavaScript](https://img.shields.io/badge/javascript-%23323330.svg?style=for-the-badge&logo=javascript&logoColor=%23F7DF1E)


## ì„¤ê³„

### CAD

Inventorë¥¼ ì‚¬ìš©í•´ 6ì¶•ë¡œë´‡ ë¶€í’ˆ ëª¨ë¸ë§
|1. Base_bottom|2. Base_cover|3. Base_shoulder|
| --- | --- | --- |
|<img src="image.png" width="1600"> | <img src="image-3.png" width="1600">|<img src="image-4.png" width="1600"> | 

|4. Arm|5. Arm_cover|6. Arm_shoudler|7. End_effector|
| --- | --- | --- | --- |
| <img src="image-8.png" width="800">|<img src="image-12.png" width="800"> | <img src="image-10.png" width="800">|<img src="image-11.png" width="800"> |

|ì¡°ë¦½ëœ ëª¨ìŠµ|
| --- |
|<img src="image-13.png" width="500">|

### DH Parameter
ëª¨í„°ì˜ íšŒì „ì¶•ì„ Zì¶•ìœ¼ë¡œ ê¸°ì¤€ ì‚¼ì•„ Modified DH Parameterë¥¼ ê³„ì‚°

```python

    # DH íŒŒë¼ë¯¸í„° ì„¤ì • [theta(z), d(z), a(x), alpha(x)]
    # ê°ë„ : rad, ê¸¸ì´ : m    
    DH_parameters = [
        [joint_angles[0],            0.056,         0,         0],
        [joint_angles[1],            0.042,      0.03,  -np.pi/2],
        [joint_angles[2]-np.pi/2,   0.0412,      0.13,  -np.pi/2],
        [joint_angles[3],           0.0309,     0.032,   np.pi/2],
        [joint_angles[4],           0.0412,      0.13,   np.pi/2],
        [joint_angles[5],           0.0612,     0.032,         0]
    ]

```

## ì œì–´

### Rasberry pi
<img src="image-14.png" width="500">


```Python
# ëª¨í„° ì œì–´ ì½”ë“œ
from flask import Flask, request
import RPi.GPIO as GPIO
import time
import forward

app = Flask(__name__)

# GPIO í•€ ì„¤ì •
MOTOR_PINS = {
    "base": 18,       # GPIO 18ë²ˆ í•€
    "shoulder": 8,    # GPIO 8ë²ˆ í•€
    "elbow": 12,      # GPIO 12ë²ˆ í•€
    "wrist1": 22,     # GPIO 22ë²ˆ í•€
    "wrist2": 11,     # GPIO 11ë²ˆ í•€
    "wrist3": 13      # GPIO 13ë²ˆ í•€
}

GPIO.setmode(GPIO.BCM)
for pin in MOTOR_PINS.values():
    GPIO.setup(pin, GPIO.OUT)

# PWM ì„¤ì • (50Hz)
pwm = {motor: GPIO.PWM(pin, 50) for motor, pin in MOTOR_PINS.items()}
for motor_pwm in pwm.values():
    motor_pwm.start(0)

# í˜„ì¬ ê°ë„ ì¶”ì  ë³€ìˆ˜
current_angles = {motor: 0 for motor in MOTOR_PINS.keys()}  # ì´ˆê¸° ê°ë„ëŠ” 0ìœ¼ë¡œ ì„¤ì •

# ê°ë„ ì„¤ì • í•¨ìˆ˜
def set_angle(motor, angle):
    """
    ì…ë ¥ëœ ê°ë„ (-180 ~ 180)ë¥¼ ì„œë³´ ëª¨í„°ë¡œ ì´ë™.
    ì´ë™ ë°©í–¥ì€ í˜„ì¬ ê°ë„ì™€ ëª©í‘œ ê°ë„ë¥¼ ë¹„êµí•˜ì—¬ ê²°ì •.
    """
    if angle < -90 or angle > 90:
        raise ValueError("Angle out of bounds! Must be between -90 and 90.")

    # í˜„ì¬ ê°ë„ ê°€ì ¸ì˜¤ê¸°
    current_angle = current_angles[motor]

    # ì´ë™ ë°©í–¥ ê³„ì‚°
    if current_angle < angle:  # ëª©í‘œ ê°ë„ê°€ ë” í¬ë©´
        if current_angle < 0 and angle < 0:  # ë‘˜ ë‹¤ ìŒìˆ˜ì¼ ê²½ìš°
            direction = "clockwise" if abs(current_angle) < abs(angle) else "counterclockwise"
        else:  # ì¼ë°˜ì ìœ¼ë¡œ ëª©í‘œ ê°ë„ê°€ ë” í¬ë©´ ì‹œê³„ ë°©í–¥
            direction = "clockwise"
    else:  # ëª©í‘œ ê°ë„ê°€ ë” ì‘ìœ¼ë©´
        if current_angle > 0 and angle > 0:  # ë‘˜ ë‹¤ ì–‘ìˆ˜ì¼ ê²½ìš°
            direction = "counterclockwise" if current_angle > angle else "clockwise"
        else:  # ì¼ë°˜ì ìœ¼ë¡œ ëª©í‘œ ê°ë„ê°€ ë” ì‘ìœ¼ë©´ ë°˜ì‹œê³„ ë°©í–¥
            direction = "counterclockwise"

    # ì´ë™ ë°©í–¥ ì¶œë ¥
    print(f"Moving {motor} {direction} from {current_angle}Â° to {angle}Â°.")

    # -180 ~ 180 ë²”ìœ„ë¥¼ 0 ~ 180ë¡œ ë³€í™˜
    converted_angle = 90 + angle  # -180 ~ 180 -> 0 ~ 180
    duty_cycle = 2.5 + (converted_angle / 18)  # Duty Cycle ê³„ì‚°

    # GPIO ì œì–´
    pin = MOTOR_PINS[motor]
    GPIO.output(pin, True)
    pwm[motor].ChangeDutyCycle(duty_cycle)
    time.sleep(1)
    GPIO.output(pin, False)
    pwm[motor].ChangeDutyCycle(0)

    # í˜„ì¬ ê°ë„ë¥¼ ì—…ë°ì´íŠ¸
    current_angles[motor] = angle

@app.route("/control", methods=["POST"])
def control():
    data = request.get_json()
    motor = data.get("motor", None)  # ëª¨í„° ID ê°€ì ¸ì˜¤ê¸°
    angle = data.get("angle", None)  # ê°ë„ ê°’ ê°€ì ¸ì˜¤ê¸°

    if motor not in MOTOR_PINS:
        return "Invalid motor! Must be one of the valid motors.", 400

    if angle is not None and -90 <= angle <= 90:
        try:
            set_angle(motor, angle)
            return f"Moved {motor} to {angle} degrees!", 200
        except ValueError as e:
            return str(e), 400
    else:
        return "Invalid angle! Must be between -180 and 180.", 400

if __name__ == "__main__":
    try:
        app.run(host="0.0.0.0", port=5000)
    except KeyboardInterrupt:
        for motor_pwm in pwm.values():
            motor_pwm.stop()
        GPIO.cleanup()

```

### ì •ê¸°êµ¬í•™ & ì—­ê¸°êµ¬í•™

```python
import numpy as np
# ì •ê¸°êµ¬í•™
def forward(joint_angles):

    # ì¡°ì¸íŠ¸ ê°ë„ë¥¼ ë¼ë””ì•ˆ ë‹¨ìœ„ë¡œ ë³€í™˜
    joint_angles = np.radians(joint_angles)

    # DH íŒŒë¼ë¯¸í„° ì„¤ì • [theta(z), d(z), a(x), alpha(x)]
    # ê°ë„ : rad, ê¸¸ì´ : m   
    DH_parameters = [
        [joint_angles[0],            0.056,         0,         0],
        [joint_angles[1],            0.042,      0.03,  -np.pi/2],
        [joint_angles[2]-np.pi/2,   0.0412,      0.13,  -np.pi/2],
        [joint_angles[3],           0.0309,     0.032,   np.pi/2],
        [joint_angles[4],           0.0412,      0.13,   np.pi/2],
        [joint_angles[5],           0.0612,     0.032,         0]
    ]
    
    # ì´ˆê¸° ë³€í™˜ í–‰ë ¬(4x4 ë‹¨ìœ„ í–‰ë ¬)
    final_matrix = np.eye(4)

    # ê° ë§í¬ì— ëŒ€í•´ ë³€í™˜ í–‰ë ¬ ê³„ì‚°
    for params in DH_parameters:
        theta, d, a, alpha = params  # DH íŒŒë¼ë¯¸í„°ì—ì„œ ê°’ ì¶”ì¶œ
        
        # ë³€í™˜ í–‰ë ¬ ìƒì„± rot(Z) > trans(Z) > trans(X) > rot(X)
        T = np.array([
            [np.cos(theta), -np.sin(theta)*np.cos(alpha),  np.sin(theta)*np.sin(alpha), a*np.cos(theta)],
            [np.sin(theta),  np.cos(theta)*np.cos(alpha), -np.cos(theta)*np.sin(alpha), a*np.sin(theta)],
            [0,              np.sin(alpha),               np.cos(alpha),              d],
            [0,              0,                           0,                          1]
        ])
        
        # ì´ì „ ë³€í™˜ í–‰ë ¬ê³¼ í˜„ì¬ ë³€í™˜ í–‰ë ¬ì„ ê³±í•˜ì—¬ ëˆ„ì 
        final_matrix = np.dot(final_matrix, T)

    # ìµœì¢… ë³€í™˜ í–‰ë ¬ì—ì„œ ìœ„ì¹˜ ê°’ ì¶”ì¶œ
    x = final_matrix[0, 3]
    y = final_matrix[1, 3]
    z = final_matrix[2, 3]

    # ìµœì¢… ë³€í™˜ í–‰ë ¬ì—ì„œ ZYX ì˜¤ì¼ëŸ¬ ê°ë„ ê³„ì‚°
    rz = np.arctan2(final_matrix[1, 0], final_matrix[0, 0])  # Zì¶• íšŒì „
    ry = np.arctan2(-final_matrix[2, 0], np.sqrt(final_matrix[2, 1]**2 + final_matrix[2, 2]**2))  # Yì¶• íšŒì „
    rx = np.arctan2(final_matrix[2, 1], final_matrix[2, 2])  # Xì¶• íšŒì „

    # ë¼ë””ì•ˆì„ ë„ ë‹¨ìœ„ë¡œ ë³€í™˜
    rx = np.degrees(rx)
    ry = np.degrees(ry)
    rz = np.degrees(rz)

    # ìµœì¢… ìœ„ì¹˜ì™€ ì˜¤ì¼ëŸ¬ ê°ë„ë¥¼ ë°˜í™˜
    return x, y, z, rx, ry, rz

# ì˜ˆì œ ì…ë ¥: ì¡°ì¸íŠ¸ ê°ë„ ë¦¬ìŠ¤íŠ¸ (ë‹¨ìœ„: ë„)
# joint_angles = [57.25147, -48.33403189, 69.0253068, 34.5098, 72.7, 25.8967]
joint_angles = [0, 0, 0, 0, 0, 0]

# í•¨ìˆ˜ í˜¸ì¶œ
x, y, z, rx, ry, rz = forward(joint_angles)

# ê²°ê³¼ ì¶œë ¥
print(f"ìœ„ì¹˜: x = {x:.3f}, y = {y:.3f}, z = {z:.3f}")
print(f"ì˜¤ì¼ëŸ¬ ê°ë„: rx = {rx:.3f}Â°, ry = {ry:.3f}Â°, rz = {rz:.3f}Â°")

```

```python
# ì—­ê¸°êµ¬í•™
import numpy as np
from numpy import deg2rad, rad2deg
from sympy import symbols, sin, cos, atan2, acos, Matrix

# ê³„ì‚°ì˜¤ì°¨ë¥¼ ë¬´ì‹œí•˜ê¸° ìœ„í•œ í•¨ìˆ˜
def custom_zero(value, tolerance=1e-6):
    return 0 if abs(value) < tolerance else value

# ë³€í™˜ í–‰ë ¬ ìƒì„± rot(Z) > trans(Z) > trans(X) > rot(X)
def dh_transform(theta, d, a, alpha):
    return np.array([
        [np.cos(theta), -np.sin(theta)*np.cos(alpha),  np.sin(theta)*np.sin(alpha), a*np.cos(theta)],
        [np.sin(theta),  np.cos(theta)*np.cos(alpha), -np.cos(theta)*np.sin(alpha), a*np.sin(theta)],
        [0,              np.sin(alpha),               np.cos(alpha),              d],
        [0,              0,                           0,                          1]
    ])

tolerance = 1e-6

# targetê°’ ë‹¨ìœ„[ìœ„ì¹˜ : mm, ê°ë„ : ë„]
x_p, y_p, z_p = 1244, 0, 950
roll, pitch, yaw = deg2rad(0), deg2rad(90), deg2rad(0)

# DH íŒŒë¼ë¯¸í„° ì„¤ì • [theta(z), d(z), a(x), alpha(x)]
# ê°ë„ : rad, ê¸¸ì´ : m 
DH_parameters = [
    [joint_angles[0],            0.056,         0,         0],
    [joint_angles[1],            0.042,      0.03,  -np.pi/2],
    [joint_angles[2]-np.pi/2,   0.0412,      0.13,  -np.pi/2],
    [joint_angles[3],           0.0309,     0.032,   np.pi/2],
    [joint_angles[4],           0.0412,      0.13,   np.pi/2],
    [joint_angles[5],           0.0612,     0.032,         0]
]

# target matrix ìƒì„±
loc = np.array([
    [1, 0, 0, x_p/1000],
    [0, 1, 0, y_p/1000],
    [0, 0, 1, z_p/1000],
    [0, 0, 0, 1]
])

rot_z = np.array([
    [np.cos(roll), -np.sin(roll), 0, 0],
    [np.sin(roll),  np.cos(roll), 0, 0],
    [0,             0,            1, 0],
    [0,             0,            0, 1]
])

rot_y = np.array([
    [np.cos(pitch),  0, np.sin(pitch), 0],
    [0,              1, 0,             0],
    [-np.sin(pitch), 0, np.cos(pitch), 0],
    [0,              0, 0,             1]
])

rot_x = np.array([
    [1,  0,           0,          0],
    [0,  np.cos(yaw), -np.sin(yaw), 0],
    [0,  np.sin(yaw),  np.cos(yaw), 0],
    [0,  0,           0,          1]
])

zyx_rot = rot_z @ rot_y @ rot_x

# joint 1~3 ê³„ì‚°
trans625 = loc @ zyx_rot @ np.array([0, 0, -DH_parameters[5][1], 1])

deg1_1 = rad2deg(float(atan2(trans625[1], trans625[0])))
h_1 = np.sqrt(trans625[0]**2 + trans625[1]**2) - DH_parameters[0][2]
h_2 = trans625[2]
h_0 = np.sqrt(h_1**2 + h_2**2)

B_1 = rad2deg(float(atan2(h_2, h_1)))
B_2 = rad2deg(float(acos((h_0**2 + DH_parameters[1][2]**2 - DH_parameters[3][1]**2) / (2 * h_0 * DH_parameters[1][2]))))
r_1 = rad2deg(float(acos((DH_parameters[1][2]**2 + DH_parameters[3][1]**2 - h_0**2) / (2 * DH_parameters[1][2] * DH_parameters[3][1]))))

deg2_2 = 90 - B_1 - B_2
deg3_3 = 180 - r_1

# DH parametersì— joint 1~3 ì—…ë°ì´íŠ¸
DH_parameters[0][0] = deg2rad(deg1_1)
DH_parameters[1][0] = deg2rad(deg2_2 - 90)
DH_parameters[2][0] = deg2rad(deg3_3 - 90)

# joint 1-3 ê¹Œì§€ ì •ê¸°êµ¬í•™
final_matrix_13 = np.eye(4)
for i in range(3):
    final_matrix_13 = final_matrix_13 @ dh_transform(*DH_parameters[i])

# joint 4-6 ê¹Œì§€ ì—­ê¸°êµ¬í•™
final_matrix_46 = np.eye(4)
for i in range(3, 6):
    final_matrix_46 = final_matrix_46 @ dh_transform(*DH_parameters[i])

rot_36 = np.linalg.inv(final_matrix_13[:3, :3]) @ zyx_rot[:3, :3]
rot_36_clean = np.vectorize(lambda x: custom_zero(x, tolerance))(rot_36)

# joint 4~6 ê³„ì‚°
deg4_4 = rad2deg(float(atan2(rot_36_clean[1, 2], rot_36_clean[0, 2])))
deg5_5 = rad2deg(float(acos(rot_36_clean[2, 2])))
deg6_6 = rad2deg(float(atan2(rot_36_clean[2, 1], -rot_36_clean[2, 0])))

# ìµœì¢… joint ê°’
deg = [deg1_1, deg2_2, deg3_3, deg4_4, deg5_5, deg6_6]
print("Joint Angles (degrees):", deg)

```

## ì›¹

### Python
```python

from flask import Flask, render_template, request, jsonify
import numpy as np
import requests
from forward import forward  # forward.pyì˜ forward í•¨ìˆ˜ import
from inverse import calculate_angles  # inverse.pyì˜ calculate_angles í•¨ìˆ˜ import

app = Flask(__name__)

@app.route("/")
def index():
    return render_template("index.html")

@app.route('/forward', methods=['POST'])
def forward_kinematics():
    data = request.json
    joint_angles = np.radians(data['joint_angles'])
    DH_parameters = [
    [joint_angles[0],            0.056,         0,         0],
    [joint_angles[1],            0.042,      0.03,  -np.pi/2],
    [joint_angles[2]-np.pi/2,   0.0412,      0.13,  -np.pi/2],
    [joint_angles[3],           0.0309,     0.032,   np.pi/2],
    [joint_angles[4],           0.0412,      0.13,   np.pi/2],
    [joint_angles[5],           0.0612,     0.032,         0]
]

    final_matrix = np.eye(4)
    for params in DH_parameters:
        theta, d, a, alpha = params
        T = np.array([
            [np.cos(theta), -np.sin(theta)*np.cos(alpha), np.sin(theta)*np.sin(alpha), a*np.cos(theta)],
            [np.sin(theta), np.cos(theta)*np.cos(alpha), -np.cos(theta)*np.sin(alpha), a*np.sin(theta)],
            [0, np.sin(alpha), np.cos(alpha), d],
            [0, 0, 0, 1]
        ])
        final_matrix = np.dot(final_matrix, T)

    x = final_matrix[0, 3]
    y = final_matrix[1, 3]
    z = final_matrix[2, 3]
    rz = np.arctan2(final_matrix[1, 0], final_matrix[0, 0])
    ry = np.arctan2(-final_matrix[2, 0], np.sqrt(final_matrix[2, 1]**2 + final_matrix[2, 2]**2))
    rx = np.arctan2(final_matrix[2, 1], final_matrix[2, 2])

    return jsonify({
        'x': x,
        'y': y,
        'z': z,
        'rx': np.degrees(rx),
        'ry': np.degrees(ry),
        'rz': np.degrees(rz)
    })

if __name__ == '__main__':
    app.run(debug=True)

```

### HTML

```HTML

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MG996r Servo Motor Control</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .col {
            flex: 1;
            min-width: 300px;
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .motor-control {
            margin-bottom: 20px;
        }
        .motor-control h3 {
            margin-top: 0;
        }
        label {
            font-weight: bold;
        }
        input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .result {
            background-color: #f1f1f1;
            border-radius: 8px;
            padding: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>MG996r Servo Motor Control</h1>
        <div class="row">
            <div class="col">
                <div id="motor-controls">
                    <div class="motor-control">
                        <h3>Base</h3>
                        <label>Angle:</label>
                        <input type="number" id="motor-base" min="-90" max="90" value="0" onchange="calculateForwardKinematics()" />
                    </div>
                    <div class="motor-control">
                        <h3>Shoulder</h3>
                        <label>Angle:</label>
                        <input type="number" id="motor-shoulder" min="-90" max="90" value="0" onchange="calculateForwardKinematics()" />
                    </div>
                    <div class="motor-control">
                        <h3>Elbow</h3>
                        <label>Angle:</label>
                        <input type="number" id="motor-elbow" min="-90" max="90" value="0" onchange="calculateForwardKinematics()" />
                    </div>
                    <div class="motor-control">
                        <h3>Wrist 1</h3>
                        <label>Angle:</label>
                        <input type="number" id="motor-wrist1" min="-90" max="90" value="0" onchange="calculateForwardKinematics()" />
                    </div>
                    <div class="motor-control">
                        <h3>Wrist 2</h3>
                        <label>Angle:</label>
                        <input type="number" id="motor-wrist2" min="-90" max="90" value="0" onchange="calculateForwardKinematics()" />
                    </div>
                    <div class="motor-control">
                        <h3>Wrist 3</h3>
                        <label>Angle:</label>
                        <input type="number" id="motor-wrist3" min="-90" max="90" value="0" onchange="calculateForwardKinematics()" />
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="result" id="result">
                    <h3>Result:</h3>
                    <p id="position">Position: x = 0, y = 0, z = 0</p>
                    <p id="euler">Euler Angles: rx = 0Â°, ry = 0Â°, rz = 0Â°</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let pyodideReady = false;
        let pyodide;

        // Pyodide ì´ˆê¸°í™”
        async function initPyodide() {
            pyodide = await loadPyodide();
            await pyodide.loadPackage('numpy');
            pyodideReady = true;
            console.log('Pyodide loaded');
        }

        initPyodide();

        // Python ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ Forward Kinematics ê³„ì‚°
        async function calculatePythonFK(jointAngles) {
            if (!pyodideReady) {
                console.error('Pyodide is not ready');
                return;
            }

            const pythonCode = `
import numpy as np

def forward(joint_angles):
    joint_angles = np.radians(joint_angles)
    DH_parameters = [
        [joint_angles[0], 0.056, 0, 0],
        [joint_angles[1], 0.042, 0.03, -np.pi/2],
        [joint_angles[2]-np.pi/2, 0.0412, 0.13, -np.pi/2],
        [joint_angles[3], 0.0309, 0.032, np.pi/2],
        [joint_angles[4], 0.0412, 0.13, np.pi/2],
        [joint_angles[5], 0.0612, 0.032, 0]
    ]

    final_matrix = np.eye(4)
    for params in DH_parameters:
        theta, d, a, alpha = params
        T = np.array([
            [np.cos(theta), -np.sin(theta)*np.cos(alpha), np.sin(theta)*np.sin(alpha), a*np.cos(theta)],
            [np.sin(theta), np.cos(theta)*np.cos(alpha), -np.cos(theta)*np.sin(alpha), a*np.sin(theta)],
            [0, np.sin(alpha), np.cos(alpha), d],
            [0, 0, 0, 1]
        ])
        final_matrix = np.dot(final_matrix, T)

    x = final_matrix[0, 3]
    y = final_matrix[1, 3]
    z = final_matrix[2, 3]
    rz = np.arctan2(final_matrix[1, 0], final_matrix[0, 0])
    ry = np.arctan2(-final_matrix[2, 0], np.sqrt(final_matrix[2, 1]**2 + final_matrix[2, 2]**2))
    rx = np.arctan2(final_matrix[2, 1], final_matrix[2, 2])
    return x, y, z, np.degrees(rx), np.degrees(ry), np.degrees(rz)

joint_angles = ${JSON.stringify(jointAngles)}
x, y, z, rx, ry, rz = forward(joint_angles)
(x, y, z, rx, ry, rz)
`;

            return await pyodide.runPythonAsync(pythonCode);
        }

        // HTML ì—…ë°ì´íŠ¸
        async function calculateForwardKinematics() {
            const angles = [
                parseFloat(document.getElementById('motor-base').value),
                parseFloat(document.getElementById('motor-shoulder').value),
                parseFloat(document.getElementById('motor-elbow').value),
                parseFloat(document.getElementById('motor-wrist1').value),
                parseFloat(document.getElementById('motor-wrist2').value),
                parseFloat(document.getElementById('motor-wrist3').value),
            ];

            try {
                const [x, y, z, rx, ry, rz] = await calculatePythonFK(angles);
                document.getElementById('position').textContent = `Position: x = ${x.toFixed(3)}, y = ${y.toFixed(3)}, z = ${z.toFixed(3)}`;
                document.getElementById('euler').textContent = `Euler Angles: rx = ${rx.toFixed(3)}Â°, ry = ${ry.toFixed(3)}Â°, rz = ${rz.toFixed(3)}Â°`;
            } catch (error) {
                console.error('Error calculating FK:', error);
            }
        }
    </script>
</body>
</html>

```

## 6ì¶•ë¡œë´‡ ì œì‘
